Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64"
  config.vm.hostname = "lvm-lab"

  config.vm.provider "virtualbox" do |vb|
    vb.memory = "1024"
    vb.cpus = 1

    # Create and attach additional disks
    (1..3).each do |i|
      disk_file = "./disk_#{i}.vdi"

      # Create disk if it doesn't exist
      unless File.exist?(disk_file)
        vb.customize [
          'createmedium', 'disk',
          '--filename', File.expand_path(disk_file),
          '--size', 5 * 1024,
          '--format', 'VDI'
        ]
      end

      # Attach disk to VM
      vb.customize [
        'storageattach', :id,
        '--storagectl', 'SCSI',
        '--port', i + 1,
        '--device', 0,
        '--type', 'hdd',
        '--medium', File.expand_path(disk_file)
      ]
    end
  end

  config.vm.synced_folder ".", "/vagrant"
end